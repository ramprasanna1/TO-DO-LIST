<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pips Tracker To-Do</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    /* ===== Variables and General Styles ===== */
    :root {
      --bg: #ffffff;
      --text: #333333;
      --task-bg: #f9f9f9;
      --input-bg: #ffffff;
      --button-bg: #007bff;
      --button-hover: #0056b3;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding-top: 40px;
    }

    .container {
      background: var(--input-bg);
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      max-width: 500px;
      width: 90%;
      animation: fadeIn 0.5s ease-in-out;
    }

    h2 {
      text-align: center;
      margin-bottom: 10px;
    }

    .input-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    input[type="text"],
    input[type="date"] {
      flex: 1;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 8px;
      background: var(--input-bg);
      color: var(--text);
    }

    button {
      padding: 10px 16px;
      border: none;
      background: var(--button-bg);
      color: white;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: var(--button-hover);
    }

    .task {
      background: var(--task-bg);
      border-radius: 10px;
      padding: 10px;
      margin: 10px 0;
      position: relative;
    }

    .task.completed {
      text-decoration: line-through;
      opacity: 0.6;
    }

    .timestamp {
      font-size: 12px;
      color: #888;
      margin-top: 4px;
    }

    .actions {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 8px;
    }

    .actions button {
      background: none;
      color: var(--text);
      border: none;
      cursor: pointer;
      font-size: 14px;
    }

    .actions button:hover {
      color: red;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @media (max-width: 600px) {
      .input-row { flex-direction: column; }
      button { width: 100%; }
    }

    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      height: 100%;
      width: 300px;
      background: #f0f0f0;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: 1000;
      overflow-y: auto;
    }

    .sidebar.open {
      transform: translateX(0);
    }

    .toggle-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      background: #007bff;
      color: white;
      padding: 10px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      z-index: 1100;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #333;
    }

    .close-btn:hover { color: red; }

    .summary-group {
      margin-bottom: 20px;
    }

    .summary-group h4 {
      margin-bottom: 8px;
    }

    .summary-group ul {
      list-style: none;
      padding-left: 0;
    }

    .summary-group li {
      font-weight: bold;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>

<!-- Sidebar Toggle -->
<button class="toggle-btn" onclick="toggleSidebar()">☰ Summary</button>

<!-- Sidebar -->
<div id="sidebar" class="sidebar">
  <button class="close-btn" onclick="toggleSidebar()">✕</button>
  <h3>📊 Pips Summaries</h3>
  <div id="dailySummary" class="summary-group"></div>
  <div id="weeklySummary" class="summary-group"></div>
  <div id="monthlySummary" class="summary-group"></div>
</div>

<!-- Main Content -->
<div class="container">
  <div id="pipSummary" style="margin-bottom: 15px; font-weight: bold; text-align: center;"></div>

  <h2>📊 Pips Tracker To-Do</h2>

  <div class="input-row">
    <input type="text" id="taskInput" placeholder="Add entry (e.g., +100 pips, -50 loss)" />
    <button onclick="addTask()">Add</button>
  </div>

  <div class="input-row">
    <input type="text" id="searchInput" placeholder="Search entries..." oninput="searchTasks()" />
    <input type="date" id="dateSearch" oninput="searchTasks()" />
  </div>

  <div class="input-row">
    <button onclick="exportToExcel()">📤 Export to Excel</button>
  </div>

  <ul id="taskList" style="padding-left: 0; list-style: none;"></ul>
</div>

<script>
  const taskInput = document.getElementById("taskInput");
  const taskList = document.getElementById("taskList");
  const searchInput = document.getElementById("searchInput");
  const dateSearch = document.getElementById("dateSearch");

  function toggleSidebar() {
  const sidebar = document.getElementById("sidebar");
  const toggleBtn = document.querySelector(".toggle-btn");
  const isOpen = sidebar.classList.toggle("open");
  toggleBtn.style.display = isOpen ? "none" : "block";
}


  function getTasks() {
    return JSON.parse(localStorage.getItem("tasks") || "[]");
  }

  function saveTasks(tasks) {
    localStorage.setItem("tasks", JSON.stringify(tasks));
  }

  function updatePipSummary() {
    const tasks = getTasks();
    let pos = 0, neg = 0;

    tasks.forEach(task => {
      const match = task.text.match(/[-+]?\d*\.?\d+/);
      if (match) {
        const val = parseFloat(match[0]);
        if (!isNaN(val)) {
          if (val >= 0) pos += val;
          else neg += val;
        }
      }
    });

    const net = pos + neg;

    document.getElementById("pipSummary").innerHTML = `
      📈 Gain: <span style="color:green;">${pos.toFixed(2)} pips</span><br/>
      📉 Loss: <span style="color:red;">${Math.abs(neg).toFixed(2)} pips</span><br/>
      🧮 Net: <strong style="color:${net >= 0 ? 'green' : 'red'};">${net >= 0 ? '+' : ''}${net.toFixed(2)}</strong> pips
    `;
  }

  function addTask() {
    const text = taskInput.value.trim();
    if (!text) return alert("Please enter a task!");
    const now = new Date();
    const task = {
      id: Date.now(),
      text,
      timestamp: now.toLocaleString(),
      date: now.toISOString().split("T")[0],
      completed: false
    };

    const tasks = getTasks();
    tasks.unshift(task);
    saveTasks(tasks);
    renderTasks();
    taskInput.value = "";
  }

  function toggleComplete(id) {
    const tasks = getTasks();
    tasks.forEach(task => { if (task.id === id) task.completed = !task.completed });
    saveTasks(tasks);
    renderTasks();
  }

  function deleteTask(id) {
    if (!confirm("Delete this entry?")) return;
    const tasks = getTasks().filter(task => task.id !== id);
    saveTasks(tasks);
    renderTasks();
  }

  function editTask(id) {
    const tasks = getTasks();
    const task = tasks.find(t => t.id === id);
    const newText = prompt("Edit entry:", task.text);
    if (newText && newText.trim() !== "") {
      task.text = newText.trim();
      const now = new Date();
      task.timestamp = now.toLocaleString();
      task.date = now.toISOString().split("T")[0];
      saveTasks(tasks);
      renderTasks();
    }
  }

  function searchTasks() {
    renderTasks(searchInput.value, dateSearch.value);
  }

  function renderTasks(textFilter = "", dateFilter = "") {
    const tasks = getTasks();
    taskList.innerHTML = "";
    const filtered = tasks.filter(task =>
      task.text.toLowerCase().includes(textFilter.toLowerCase()) &&
      (!dateFilter || task.date === dateFilter)
    );

    filtered.forEach(task => {
      const li = document.createElement("li");
      li.className = `task${task.completed ? " completed" : ""}`;
      const div = document.createElement("div");
      div.textContent = task.text;
      const match = task.text.match(/[-+]?\d*\.?\d+/);
      if (match) {
        const val = parseFloat(match[0]);
        div.style.color = val >= 0 ? "green" : "red";
        div.style.fontWeight = "bold";
      }
      div.style.cursor = "pointer";
      div.onclick = () => toggleComplete(task.id);

      const time = document.createElement("div");
      time.className = "timestamp";
      time.textContent = task.timestamp;

      const actions = document.createElement("div");
      actions.className = "actions";
      const editBtn = document.createElement("button");
      editBtn.innerHTML = "✏️";
      editBtn.onclick = () => editTask(task.id);
      const delBtn = document.createElement("button");
      delBtn.innerHTML = "❌";
      delBtn.onclick = () => deleteTask(task.id);
      actions.append(editBtn, delBtn);

      li.append(div, time, actions);
      taskList.appendChild(li);
    });

    updatePipSummary();
    updateSummaries();
  }

  function updateSummaries() {
  const tasks = getTasks();
  const daily = {}, weekly = {}, monthly = {};
  const now = new Date();

  tasks.forEach(task => {
    const date = new Date(task.date);
    const ageInDays = (now - date) / (1000 * 60 * 60 * 24);

    // Daily (only last 1 day)
    if (ageInDays <= 1) {
      const dailyKey = task.date;
      const val = extractValue(task.text);
      daily[dailyKey] = (daily[dailyKey] || 0) + val;
    }

    // Weekly (only last 7 days)
    if (ageInDays <= 7) {
      const weekStart = new Date(date);
      weekStart.setDate(date.getDate() - date.getDay());
      const weeklyKey = weekStart.toISOString().split("T")[0];
      const val = extractValue(task.text);
      weekly[weeklyKey] = (weekly[weeklyKey] || 0) + val;
    }

    // Monthly (only last 30 days)
    if (ageInDays <= 30) {
      const monthlyKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
      const val = extractValue(task.text);
      monthly[monthlyKey] = (monthly[monthlyKey] || 0) + val;
    }
  });

  renderGroup(daily, "dailySummary", "📅 Daily");
  renderGroup(weekly, "weeklySummary", "📆 Weekly");
  renderGroup(monthly, "monthlySummary", "🗓️ Monthly");
}

function extractValue(text) {
  const match = text.match(/[-+]?\d*\.?\d+/);
  return match ? parseFloat(match[0]) : 0;
}

function renderGroup(data, elementId, label) {
  const sorted = Object.entries(data).sort((a, b) => new Date(b[0]) - new Date(a[0]));
  const container = document.getElementById(elementId);
  container.innerHTML = `<h4>${label}</h4><ul>` +
    sorted.map(([k, v]) =>
      `<li style="color:${v >= 0 ? 'green' : 'red'}">${k}: ${v.toFixed(2)} pips</li>`
    ).join("") + `</ul>`;
}


  function exportToExcel() {
    const tasks = getTasks();
    if (tasks.length === 0) return alert("No data to export.");
    const sheetData = tasks.map(t => ({
      Task: t.text,
      Date: t.timestamp,
      Completed: t.completed ? "Yes" : "No"
    }));
    const ws = XLSX.utils.json_to_sheet(sheetData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Pips Tracker");
    XLSX.writeFile(wb, "PipsTracker.xlsx");
  }

  window.onload = () => {
    if (getTasks().length === 0) {
      saveTasks([
        { id: Date.now(), text: "+50 pips", timestamp: new Date().toLocaleString(), date: new Date().toISOString().split("T")[0], completed: false }
      ]);
    }
    renderTasks();
  };
</script>
</body>
</html>
